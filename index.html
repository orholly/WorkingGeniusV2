<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working Genius Pairings Viewer - Grid</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; } /* gray-100 */
        html.dark ::-webkit-scrollbar-track { background: #1f2937; } /* gray-800 */
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; } /* slate-400 */
        html.dark ::-webkit-scrollbar-thumb { background: #475569; } /* slate-600 */
        ::-webkit-scrollbar-thumb:hover { background: #64748b; } /* slate-500 */
        html.dark ::-webkit-scrollbar-thumb:hover { background: #334155; } /* slate-700 */

        /* Modal Transition Styles */
        .modal-backdrop {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        .modal-hidden {
             pointer-events: none; /* Prevent interaction when hidden */
             opacity: 0;
        }
        .modal-hidden .modal-backdrop {
            opacity: 0;
        }
        .modal-hidden .modal-content {
            opacity: 0;
            transform: translateY(20px) scale(0.95);
        }
        .modal-visible {
            pointer-events: auto; /* Allow interaction when visible */
            opacity: 1;
        }
        .modal-visible .modal-backdrop {
            opacity: 1;
        }
        .modal-visible .modal-content {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Grid Card Hover Effect */
        .pairing-card {
            /* Added border transition */
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, border-color 0.2s ease-out;
        }
        .pairing-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        html.dark .pairing-card:hover {
             box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -4px rgba(0, 0, 0, 0.2);
             /* Optional: Slightly lighter border on hover */
             /* border-color: #475569; /* slate-600 */
        }


        /* Theme Toggle Styles */
        .toggle-checkbox:checked + .toggle-label { background-color: #3b82f6; } /* blue-500 */
        .toggle-checkbox:checked { transform: translateX(100%); background-color: #ffffff; border-color: #3b82f6; } /* white / blue-500 */
        html.dark .toggle-checkbox:checked + .toggle-label { background-color: #60a5fa; } /* blue-400 */
        html.dark .toggle-checkbox:checked { border-color: #60a5fa; } /* blue-400 */
        .toggle-label { transition: background-color 0.2s ease; }
        .toggle-checkbox { transition: transform 0.2s ease, background-color 0.2s ease, border-color 0.2s ease; }

        /* Badge Styles */
        .type-badge { font-weight: 600; padding: 0.2rem 0.6rem; border-radius: 9999px; font-size: 0.7rem; line-height: 1.2; text-transform: uppercase; letter-spacing: 0.05em; display: inline-flex; align-items: center; gap: 0.25rem; }
        .type-resp { color: #1e40af; background-color: #dbeafe; border: 1px solid #bfdbfe; }
        html.dark .type-resp { color: #93c5fd; background-color: #1e3a8a; border: 1px solid #1d4ed8; }
        .type-disrupt { color: #991b1b; background-color: #fee2e2; border: 1px solid #fecaca; }
        html.dark .type-disrupt { color: #fca5a5; background-color: #7f1d1d; border: 1px solid #b91c1c; }
        .type-mixed { color: #9d174d; background-color: #fce7f3; border: 1px solid #fbcfe8; }
        html.dark .type-mixed { color: #f9a8d4; background-color: #831843; border: 1px solid #be185d; }
        .value-badge {
            display: inline-flex; align-items: center; gap: 0.3rem;
            padding: 0.3rem 0.8rem; margin-right: 0.5rem; margin-bottom: 0.5rem;
            border-radius: 0.375rem;
            /* *** MODIFICATION: Font size sm -> base *** */
            font-size: 1rem; /* text-base */
            font-weight: 500;
            border: 1px solid transparent;
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, opacity 0.3s ease-in-out; /* Added opacity transition */
            cursor: default;
         }
        /* Dimming style for inactive badges */
        .value-badge-dimmed {
            opacity: 0.5;
        }
        html.dark .value-badge-dimmed {
             opacity: 0.4;
        }

        html.dark .value-badge.courageous { background-color: #7f1d1d; color: #fecaca; border-color: #b91c1c; }
        html.dark .value-badge.humble { background-color: #713f12; color: #fef08a; border-color: #a16207; }
        html.dark .value-badge.empowering { background-color: #14532d; color: #bbf7d0; border-color: #16a34a; }
        html.dark .value-badge.connected { background-color: #1e3a8a; color: #bfdbfe; border-color: #1d4ed8; }
        html.dark .value-badge.kind { background-color: #701a75; color: #f5d0fe; border-color: #c026d3; }


        /* Genius Name Highlighting */
        .interaction-text strong, .modal-interaction-text strong { font-weight: 600; padding: 0.1em 0.3em; margin: -0.1em -0.3em; border-radius: 0.25em; transition: background-color 0.2s ease, color 0.2s ease; }
        .interaction-text strong.wonder, .modal-interaction-text strong.wonder { color: #0f766e; background-color: #ccfbf1;} html.dark .interaction-text strong.wonder, html.dark .modal-interaction-text strong.wonder { color: #99f6e4; background-color: #115e59;}
        .interaction-text strong.invention, .modal-interaction-text strong.invention { color: #6d28d9; background-color: #ede9fe;} html.dark .interaction-text strong.invention, html.dark .modal-interaction-text strong.invention { color: #c4b5fd; background-color: #4c1d95;}
        .interaction-text strong.discernment, .modal-interaction-text strong.discernment { color: #1d4ed8; background-color: #dbeafe;} html.dark .interaction-text strong.discernment, html.dark .modal-interaction-text strong.discernment { color: #93c5fd; background-color: #1e3a8a;}
        .interaction-text strong.galvanizing, .modal-interaction-text strong.galvanizing { color: #c2410c; background-color: #ffedd5;} html.dark .interaction-text strong.galvanizing, html.dark .modal-interaction-text strong.galvanizing { color: #fdba74; background-color: #7c2d12;}
        .interaction-text strong.enablement, .modal-interaction-text strong.enablement { color: #15803d; background-color: #dcfce7;} html.dark .interaction-text strong.enablement, html.dark .modal-interaction-text strong.enablement { color: #86efac; background-color: #14532d;}
        .interaction-text strong.tenacity, .modal-interaction-text strong.tenacity { color: #b91c1c; background-color: #fee2e2;} html.dark .interaction-text strong.tenacity, html.dark .modal-interaction-text strong.tenacity { color: #fca5a5; background-color: #7f1d1d;}

        /* Modal Section Headers */
        .modal-section-header {
            display: flex; align-items: center; gap: 0.5rem;
             /* *** MODIFICATION: Font size base -> lg *** */
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; margin-bottom: 1rem;
        }

        /* Modal Dialogue Section Styling */
        .modal-dialogue-item { display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.5rem 0; }
        .modal-dialogue-item svg { flex-shrink: 0; margin-top: 0.2em; }
        .modal-dialogue-item strong { font-weight: 600; display: block; margin-bottom: 0.1rem; }

        /* Utility for focus rings */
        .focus-ring:focus { outline: 2px solid transparent; outline-offset: 2px; }
        .focus-ring:focus-visible {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        html.dark .focus-ring:focus-visible {
             box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.6);
        }

        /* Styling for the section containers inside the modal */
        .modal-section-container {
            border-radius: 0.5rem;
            padding: 1.25rem;
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
        }
        html.dark .modal-section-container {
             background-color: #1f2937; /* slate-800 */
             border-color: #374151; /* slate-700 */
        }

        /* Overview section specific label styling */
        .overview-label {
            /* *** MODIFICATION: Font size xs -> sm *** */
            font-size: 0.875rem; /* text-sm */
            /* font-weight: 500; /* Removed font-medium */
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        html.dark .overview-label {
            color: #9ca3af;
        }

        /* Styling for the inner cards within the Overview section */
        .overview-card {
            background-color: #f9fafb; /* gray-50 */
            border: 1px solid #f3f4f6; /* gray-100 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.75rem; /* p-3 */
        }
        html.dark .overview-card {
             background-color: #374151; /* slate-700 */
             border-color: #4b5563; /* slate-600 */
        }

        /* Utility to extract emoji/icon from name */
        .pairing-icon {
            /* Adjusted size to match new title size */
            font-size: 1.125em; /* text-lg */
            line-height: 1;
        }
        .pairing-name-text {
             /* Styles for the text part of the name if needed */
        }

    </style>
    <script>
        // Set theme ASAP to avoid FOUC
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.className = savedTheme;

        // Tailwind config
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'], }, } }
        }
    </script>
</head>
<body class="bg-slate-100 dark:bg-gray-900 flex flex-col items-center justify-start min-h-screen p-4 sm:p-6 lg:p-8 transition-colors duration-300">

    <header class="w-full max-w-6xl mx-auto mb-6 md:mb-10 text-center">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-900 dark:text-white mb-2">
            Working Genius Pairings
        </h1>
        <p class="text-base sm:text-lg text-slate-600 dark:text-slate-400">
            Explore the dynamics of different Working Genius combinations. Click a card for details.
        </p>
    </header>

    <div class="fixed top-4 right-4 z-50">
        <div class="bg-white dark:bg-slate-800 rounded-full shadow-md p-1 flex items-center space-x-2">
             <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-500"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
            <div class="relative inline-block w-10 align-middle">
                <input type="checkbox" id="theme-toggle" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-2 border-gray-300 appearance-none cursor-pointer dark:bg-slate-500 dark:border-slate-600"/>
                <label for="theme-toggle" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer dark:bg-slate-700"></label>
            </div>
             <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </div>
    </div>

    <main class="w-full max-w-5xl mx-auto px-2">
        <div id="pairings-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 md:gap-5">
            <p class="text-center text-slate-500 dark:text-slate-400 text-lg py-10 col-span-full">Loading pairings...</p>
        </div>
    </main>

    <div id="pairing-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 modal-hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="modal-backdrop fixed inset-0 bg-black bg-opacity-70 dark:bg-opacity-80" aria-hidden="true"></div>

        <div class="modal-content relative bg-white dark:bg-gray-900 rounded-xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto flex flex-col">
            <div class="flex items-start justify-between p-4 sticky top-0 bg-white dark:bg-gray-900 z-10">
                <div>
                     <h2 id="modal-title" class="text-2xl font-semibold text-slate-900 dark:text-white">Pairing Name</h2>
                     <p id="modal-subtitle" class="text-base text-slate-500 dark:text-slate-400">Rank X/15 (Y.Y%)</p>
                </div>
                <button id="modal-close-button" type="button" class="text-slate-400 dark:text-slate-500 bg-transparent hover:bg-slate-200 dark:hover:bg-slate-700 rounded-full text-sm p-1.5 ml-auto inline-flex items-center focus-ring" aria-label="Close modal">
                   <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </div>

            <div class="p-4 md:p-6 space-y-4 flex-grow">
                <div class="modal-section-container">
                     <h3 class="modal-section-header text-blue-600 dark:text-blue-400">
                         <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
                         <span>Overview</span>
                     </h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-base text-slate-700 dark:text-slate-300">
                         <div class="overview-card">
                             <strong class="overview-label font-semibold">Core Strength</strong>
                             <p id="modal-core-strength" class="leading-relaxed italic"></p>
                         </div>
                         <div class="overview-card">
                             <strong class="overview-label font-semibold">Pairing Type</strong>
                             <p><span id="modal-pairing-type-badge" class="type-badge">Type</span></p>
                             <p id="modal-pairing-type-tooltip" class="leading-relaxed italic mt-1">Tooltip</p>
                         </div>
                     </div>
                 </div>

                 <div class="modal-section-container">
                     <h3 class="modal-section-header text-teal-600 dark:text-teal-400">
                         <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg>
                         <span>CHECK Value Alignment</span>
                     </h3>
                     <div id="modal-value-badges" class="mb-3 flex flex-wrap">
                         </div>
                     <p id="modal-value-rationale" class="text-base text-slate-600 dark:text-slate-300 leading-relaxed"></p>
                 </div>

                 <div class="modal-section-container">
                     <h3 class="modal-section-header text-indigo-600 dark:text-indigo-400">
                         <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                         <span>Inspirational Quote</span>
                     </h3>
                      <blockquote id="modal-quote" class="border-l-4 border-indigo-500 dark:border-indigo-500 pl-4 italic text-slate-700 dark:text-slate-300 text-base"></blockquote>
                 </div>

                 <div class="modal-section-container">
                     <h3 class="modal-section-header text-sky-600 dark:text-sky-400">
                         <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3 4 7l4 4"/><path d="M4 7h16"/><path d="m16 21 4-4-4-4"/><path d="M20 17H4"/></svg>
                         <span>Genius Interaction</span>
                     </h3>
                      <div id="modal-interaction" class="modal-interaction-text text-base text-slate-700 dark:text-slate-300 space-y-3 leading-relaxed">
                         </div>
                 </div>

                 <div class="modal-section-container">
                     <h3 class="modal-section-header text-amber-600 dark:text-amber-400">
                         <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                         <span>Common Challenges</span>
                     </h3>
                     <p id="modal-challenges" class="text-base text-slate-700 dark:text-slate-300 leading-relaxed"></p>
                 </div>

                 <div class="modal-section-container">
                     <h3 class="modal-section-header text-rose-600 dark:text-rose-400">
                         <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></svg>
                         <span>Unhealthy Tendencies</span>
                     </h3>
                     <p id="modal-tendencies" class="text-base text-slate-700 dark:text-slate-300 leading-relaxed"></p>
                 </div>

                 <div class="modal-section-container">
                     <h3 class="modal-section-header text-violet-600 dark:text-violet-400">
                         <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
                         <span>Inner Dialogue</span>
                     </h3>
                      <div class="space-y-3 text-base text-slate-700 dark:text-slate-300">
                         <div class="modal-dialogue-item">
                             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-green-600 dark:text-green-500"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                             <div><strong class="text-green-700 dark:text-green-400">Productive:</strong> <span id="modal-dialogue-productive"></span></div>
                         </div>
                         <div class="modal-dialogue-item">
                             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-600 dark:text-yellow-500"><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><path d="M9 9h.01"/><path d="M15 9h.01"/></svg>
                             <div><strong class="text-yellow-700 dark:text-yellow-400">Challenged:</strong> <span id="modal-dialogue-challenged"></span></div>
                         </div>
                         <div class="modal-dialogue-item">
                             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600 dark:text-blue-500"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                             <div><strong class="text-blue-700 dark:text-blue-400">Growth Check:</strong> <span id="modal-dialogue-growth"></span></div>
                         </div>
                     </div>
                 </div>
            </div>
        </div>
    </div>


    <footer class="w-full max-w-6xl mx-auto mt-8 md:mt-12 text-center text-sm text-slate-500 dark:text-slate-400 pb-4">
        Working Genius concepts &copy; The Table Group. Viewer created for illustrative purposes.
    </footer>


    <script>
        // --- Data (Keep the original pairingsData and inspirationQuotes) ---
        const pairingsData = [ /* ... Full pairingsData array ... */
             // Rank 1
             { name: "✅ The Loyal Finisher", letters: "ET / TE", coreStrength: "Being dependable, low-maintenance contributors who hold themselves accountable for delivering on promises.", rank: 1, frequency: 15.95, type: "Mixed", interaction: ["<strong class='tenacity'>Tenacity</strong> makes sure <strong class='enablement'>Enablement</strong>'s desire to help leads to completed actions and reliable follow-through.", "<strong class='enablement'>Enablement</strong> provides the practical support and assistance that helps <strong class='tenacity'>Tenacity</strong> push through and complete tasks effectively."], challenges: "Having a hard time saying 'no' to requests, leading to over-commitment, burnout, and lack of appreciation.", tendencies: "Taking on too many tasks without prioritizing or becoming resentful due to feeling overloaded and unacknowledged.", dialogue: { productive: "I'll make sure this gets done and will help out wherever needed.", challenged: "Why am I always the one who has to pick up the slack and finish everything?", growth: "Am I being helpful and reliable, or just spreading myself too thin?" }, valueAlignments: ["Humble", "Connected"], valueRationale: "Their reliability and responsiveness to needs show dependability and relational focus." },
             // Rank 2
             { name: "🎉 The Enthusiastic Encourager", letters: "GE / EG", coreStrength: "Being positive, exuberant, and optimistic cheerleaders for others.", rank: 2, frequency: 9.29, type: "Mixed", interaction: ["<strong class='galvanizing'>Galvanizing</strong> identifies opportunities for <strong class='enablement'>Enablement</strong> to step in and help, giving their support a clear target.", "<strong class='enablement'>Enablement</strong> provides the hands-on help and encouragement that makes <strong class='galvanizing'>Galvanizing</strong>'s enthusiastic calls to action successful."], challenges: "Being too quick to affirm others or provide unwarranted praise, potentially leading to being dismissed as naïve or insincere.", tendencies: "Avoiding necessary critical feedback or over-promising support they cannot deliver in their enthusiasm.", dialogue: { productive: "That's fantastic! I'm excited to support you in achieving this!", challenged: "Why isn't everyone else as positive and encouraging as I am?", growth: "Am I genuinely lifting others up, or just avoiding difficult truths?" }, valueAlignments: ["Empowering", "Kind"], valueRationale: "They enthusiastically encourage and support the growth of others." },
             // Rank 3
             { name: "🤝 The Insightful Collaborator", letters: "DE / ED", coreStrength: "Offering exceptional, timely, and shrewd support in a selfless manner.", rank: 3, frequency: 8.87, type: "Responsive", interaction: ["<strong class='enablement'>Enablement</strong> turns <strong class='discernment'>Discernment</strong>'s gut feelings and insights into real, practical help for others through supportive action.", "<strong class='discernment'>Discernment</strong> guides <strong class='enablement'>Enablement</strong> by intuitively sensing what help is needed and when, making their support truly effective."], challenges: "Hesitating to push people to heed their advice and being deferential when they sense resistance, often leading to feeling underappreciated.", tendencies: "Over-accommodating others' needs at the expense of their own judgment or becoming passive in offering their valuable insights.", dialogue: { productive: "I have a sense of how I can best support you with this; what do you need?", challenged: "Why doesn't anyone realize how much I'm doing and the good advice I have?", growth: "Am I genuinely helping, or just enabling others to avoid responsibility?" }, valueAlignments: ["Humble", "Empowering"], valueRationale: "They provide empathetic and selfless support to others." },
             // Rank 4
             { name: "🌟 The Idealistic Supporter", letters: "WE / EW", coreStrength: "Being valuable, low-maintenance team members with deep care for the bigger picture.", rank: 4, frequency: 7.55, type: "Responsive", interaction: ["<strong class='wonder'>Wonder</strong> keeps <strong class='enablement'>Enablement</strong> focused on the bigger picture and the 'why' behind their efforts, making their support more meaningful.", "<strong class='enablement'>Enablement</strong> puts <strong class='wonder'>Wonder</strong>'s idealistic thoughts into action by finding practical ways to support the causes and ideas they care about."], challenges: "Being overly deferential and hesitating to initiate change, preferring to let others make the first move, and disliking being overlooked.", tendencies: "Silently contributing without voicing their own ideas or feeling resentful when their efforts are taken for granted.", dialogue: { productive: "I wonder how I can best support this important cause.", challenged: "Why doesn't anyone notice how much I'm contributing?", growth: "Am I being helpful, or just avoiding taking a stand?" }, valueAlignments: ["Humble", "Connected"], valueRationale: "Their selfless support for meaningful causes and idealism highlight modesty and relational care." },
             // Rank 5
             { name: "🛠️ The Judicious Accomplisher", letters: "DT / TD", coreStrength: "Prudent, focused, and diligent completion of high-priority tasks.", rank: 5, frequency: 7.07, type: "Mixed", interaction: ["<strong class='tenacity'>Tenacity</strong> ensures <strong class='discernment'>Discernment</strong>'s thoughtful judgments result in finished tasks, done with focus and high quality.", "<strong class='discernment'>Discernment</strong> helps <strong class='tenacity'>Tenacity</strong> focus on the right tasks – the ones that truly matter – avoiding wasted effort."], challenges: "Feeling unnecessary angst about potential failure and frustration when working with others who don't share their high standards for closure.", tendencies: "Being overly critical of others' work or becoming fixated on efficiency at the expense of collaboration or flexibility.", dialogue: { productive: "We need to prioritize this and ensure it's done to a high standard.", challenged: "Why don't others have the same sense of urgency and commitment to quality?", growth: "Am I being appropriately focused on results, or too rigid in my expectations?" }, valueAlignments: ["Courageous", "Humble"], valueRationale: "Their drive to complete high-standard tasks reflects boldness and diligence." },
             // Rank 6
             { name: "🚀 The Assertive Driver", letters: "GT / TG", coreStrength: "Being highly driven individuals with high conviction and standards who get things done.", rank: 6, frequency: 6.00, type: "Disruptive", interaction: ["<strong class='tenacity'>Tenacity</strong> provides the focused drive and follow-through needed to make sure <strong class='galvanizing'>Galvanizing</strong>'s initiatives actually get completed successfully.", "<strong class='galvanizing'>Galvanizing</strong> inspires and motivates people to join <strong class='tenacity'>Tenacity</strong>'s focused efforts, helping overcome obstacles and build momentum."], challenges: "Sometimes being seen as pushy and being impatient with too much planning and brainstorming, preferring to get right to work.", tendencies: "Being overly directive and dismissive of others' input or prioritizing speed and completion over thoroughness and collaboration.", dialogue: { productive: "We need to move quickly and get this across the finish line!", challenged: "Why is everyone so hesitant and unwilling to take decisive action?", growth: "Am I being effectively assertive in driving results, or just being impatient and controlling?" }, valueAlignments: ["Courageous", "Empowering"], valueRationale: "They boldly champion new ideas and inspire action in others." },
             // Rank 7
             { name: "🎨 The Adaptable Designer", letters: "IE / EI", coreStrength: "Being creative, flexible, open to feedback, and easy to work with in developing solutions for others.", rank: 7, frequency: 5.93, type: "Mixed", interaction: ["<strong class='invention'>Invention</strong> creates new solutions specifically tailored to what <strong class='enablement'>Enablement</strong> knows others need or want.", "<strong class='enablement'>Enablement</strong> gives <strong class='invention'>Invention</strong> real-world feedback on what people actually need, making sure the creative ideas are truly useful."], challenges: "Being too quick to accommodate and avoid advocating for their own ideas, potentially leaving them feeling undervalued.", tendencies: "Suppressing their own creative insights to please others or over-committing to implement others' ideas without fully considering their own.", dialogue: { productive: "Let's brainstorm some new ways to support what you need.", challenged: "Why does everyone else's vision always take priority over my creative ideas?", growth: "Am I being adaptable and helpful, or just letting others' needs overshadow my own?" }, valueAlignments: ["Empowering", "Connected"], valueRationale: "They create flexible solutions while collaborating and serving the needs of others." },
             // Rank 8
             { name: "🔥 The Intuitive Activator", letters: "DG / GD", coreStrength: "Making rapid, surprisingly accurate assessments and inspiring action.", rank: 8, frequency: 5.70, type: "Mixed", interaction: ["<strong class='galvanizing'>Galvanizing</strong> turns <strong class='discernment'>Discernment</strong>'s quick judgments and insights into action by rallying people behind them.", "<strong class='discernment'>Discernment</strong> gives <strong class='galvanizing'>Galvanizing</strong> a gut feeling for which ideas are truly worth pushing, focusing their energy effectively."], challenges: "Sometimes being cavalier in their declarations and appearing impatient or dismissive when made to consider critical details for implementation.", tendencies: "Pushing forward with gut feelings without sufficient consideration or dismissing others' concerns as slowing progress.", dialogue: { productive: "I have a strong feeling about this direction; let's get moving on it!", challenged: "Why is everyone so hesitant when the path forward is clear?", growth: "Am I being decisive and action-oriented, or just rushing to judgment?" }, valueAlignments: ["Courageous", "Empowering"], valueRationale: "They make bold decisions and inspire action in others." },
             // Rank 9
             { name: "🏗️ The Methodical Architect", letters: "IT / TI", coreStrength: "Being precise, reliable, and planful solvers of problems with a unique blend of innovative thinking and practical implementation.", rank: 9, frequency: 5.38, type: "Disruptive", interaction: ["<strong class='tenacity'>Tenacity</strong> brings the focus and discipline needed to turn <strong class='invention'>Invention</strong>'s creative concepts into real, workable solutions.", "<strong class='invention'>Invention</strong> provides <strong class='tenacity'>Tenacity</strong> with fresh, innovative approaches, preventing them from getting stuck in routine and encouraging creative problem-solving."], challenges: "Sometimes missing the nuance of a situation or overlooking human needs in their dogged pursuit of a workable solution.", tendencies: "Becoming overly focused on the details of the plan and losing sight of the bigger picture or the impact on people.", dialogue: { productive: "I've designed an innovative yet practical solution that we can implement systematically.", challenged: "Everyone's too caught up in emotions and politics to see how elegant this solution is.", growth: "Am I balancing creative problem-solving with practical implementation needs?" }, valueAlignments: ["Courageous", "Empowering"], valueRationale: "They combine methodical execution with practical problem-solving." },
             // Rank 10
             { name: "🧠 The Discriminating Ideator", letters: "ID / DI", coreStrength: "Creative problem-solving with a strong sense of what will actually work.", rank: 10, frequency: 5.20, type: "Mixed", interaction: ["<strong class='discernment'>Discernment</strong> helps <strong class='invention'>Invention</strong> quickly spot which of their new ideas are most likely to work, acting like a reality check.", "<strong class='invention'>Invention</strong> keeps <strong class='discernment'>Discernment</strong> supplied with fresh, original ideas to evaluate, ensuring they don't get stuck on old ways."], challenges: "Appearing impatient and over-confident when their ideas face pushback, and losing interest after the initial inventive phase.", tendencies: "Dismissing others' ideas prematurely or becoming disengaged once the problem-solving sparks fade.", dialogue: { productive: "Here's a new way to approach this; I have a strong feeling it will work well.", challenged: "Why can't people see that my idea is the best solution?", growth: "Am I being genuinely confident in my ideas, or just dismissive of alternatives?" }, valueAlignments: ["Courageous", "Empowering"], valueRationale: "They confidently generate new ideas and practical solutions." },
             // Rank 11
             { name: "📝 The Careful Implementer", letters: "WT / TW", coreStrength: "Being thorough, practical, and careful contributors with a blend of steady reliability and quiet depth.", rank: 11, frequency: 5.11, type: "Mixed", interaction: ["<strong class='wonder'>Wonder</strong> pushes <strong class='tenacity'>Tenacity</strong> to understand the 'why' behind tasks, leading to more thoughtful and thorough work.", "<strong class='tenacity'>Tenacity</strong> gives <strong class='wonder'>Wonder</strong>'s curiosity a practical focus, ensuring their questions lead to carefully completed tasks and real improvements."], challenges: "Getting bogged down in questioning and delaying action, or pushing forward with tasks without fully understanding their purpose.", tendencies: "Getting bogged down in questioning and delaying action, or pushing forward with tasks without fully understanding their purpose.", dialogue: { productive: "To do this well, I need to understand why it's important and the best way to approach it.", challenged: "Why am I being asked to do this without a clear explanation or purpose?", growth: "Am I being thoughtfully diligent, or just overanalyzing and procrastinating?" }, valueAlignments: ["Humble", "Connected"], valueRationale: "Their thoughtful and practical implementation stems from understanding purpose and showing diligence." },
             // Rank 12
             { name: "📣 The Evangelizing Innovator", letters: "IG / GI", coreStrength: "Being excitable and convincing promoters of new ideas with infectious enthusiasm.", rank: 12, frequency: 5.07, type: "Disruptive", interaction: ["<strong class='invention'>Invention</strong> generates the exciting, new ideas that <strong class='galvanizing'>Galvanizing</strong> loves to get people fired up about.", "<strong class='galvanizing'>Galvanizing</strong> takes <strong class='invention'>Invention</strong>'s original ideas and spreads the word, inspiring others to get involved and make them happen."], challenges: "Being hasty to start selling ideas before fully considering their prudence and potentially being perceived as slightly over-the-top in their approach.", tendencies: "Aggressively pushing forward with underdeveloped ideas or becoming overly invested in the initial excitement without considering long-term viability.", dialogue: { productive: "I've got a breakthrough idea, and I know you'll be as excited about it as I am!", challenged: "Why isn't everyone else seeing the potential of this amazing innovation?", growth: "Am I genuinely passionate about this idea, or just enjoying the thrill of persuading others?" }, valueAlignments: ["Courageous", "Empowering"], valueRationale: "They boldly champion new ideas and inspire others to act on them." },
             // Rank 13
             { name: "🌈 The Creative Dreamer", letters: "WI / IW", coreStrength: "Being passionate idealists with an endless stream of big questions and ideas, comfortable with abstract thinking.", rank: 13, frequency: 4.98, type: "Mixed", interaction: ["<strong class='wonder'>Wonder</strong> explores possibilities and identifies needs, creating the perfect launching pad for <strong class='invention'>Invention</strong>'s ideas.", "<strong class='invention'>Invention</strong> takes <strong class='wonder'>Wonder</strong>'s big questions and 'what ifs' and turns them into specific, new ideas and potential solutions."], challenges: "Not valuing practicality, focus, or implementation as much as idealism and ingenuity, sometimes leading to stress for those seeking realism and action.", tendencies: "Generating endless ideas without considering their feasibility or becoming dismissive of practical constraints.", dialogue: { productive: "I have so many questions and ideas about how things could be different!", challenged: "Why does everyone want to stick to the same old solutions when there are so many better possibilities?", growth: "Am I being imaginative and forward-thinking, or just living in a world of hypotheticals?" }, valueAlignments: ["Courageous", "Empowering"], valueRationale: "They encourage others with a visionary approach, balancing enthusiasm and drive." },
             // Rank 14
             { name: "🧘 The Contemplative Counselor", letters: "WD / DW", coreStrength: "Offering insightful and nuanced advice using impactful words.", rank: 14, frequency: 4.88, type: "Responsive", interaction: ["<strong class='discernment'>Discernment</strong> helps <strong class='wonder'>Wonder</strong> sort through their many questions and possibilities, focusing their deep thinking on what's most insightful.", "<strong class='wonder'>Wonder</strong> gives <strong class='discernment'>Discernment</strong> new questions and angles to consider, keeping their judgment fresh and open-minded."], challenges: "Hesitating to declare certainty or express confidence in their own judgments due to their proclivity for nuance.", tendencies: "Overthinking and delaying decisions or keeping valuable insights to themselves due to a lack of confidence.", dialogue: { productive: "That's a fascinating question; let's consider the implications from a few different angles.", challenged: "Why won't anyone take the time to really think about these important questions?", growth: "Am I being thoughtful in my analysis, or just afraid to commit to a conclusion?" }, valueAlignments: ["Connected", "Kind"], valueRationale: "Their thoughtful feedback and nuanced advice demonstrate care and understanding." },
             // Rank 15
             { name: "🌍 The Philosophical Motivator", letters: "WG / GW", coreStrength: "Being excitable, curious, and enthusiastic proponents of ideas and people, balancing eagerness with caution.", rank: 15, frequency: 3.03, type: "Mixed", interaction: ["<strong class='wonder'>Wonder</strong> comes up with the inspiring possibilities and big questions that <strong class='galvanizing'>Galvanizing</strong> can rally people around.", "<strong class='galvanizing'>Galvanizing</strong> turns <strong class='wonder'>Wonder</strong>'s deep thoughts and questions into action by getting people excited and involved in exploring them."], challenges: "The potential for impulsivity or unpredictability as they shift between passionate action and cautious reflection.", tendencies: "Jumping into initiatives without fully considering the implications or losing interest when initial enthusiasm wanes.", dialogue: { productive: "Imagine if we could do this! Let's get everyone excited about the possibilities.", challenged: "Why isn't everyone else as enthusiastic about these amazing opportunities as I am?", growth: "Am I being inspiring and visionary, or just easily distracted by new shiny objects?" }, valueAlignments: ["Courageous", "Empowering"], valueRationale: "They encourage others with a visionary approach, balancing enthusiasm and drive." }
         ];
        const inspirationQuotes = { /* ... Full inspirationQuotes object ... */
            "ET / TE": `"Success is not in what you accomplish, but in the lasting impact of your results."`,
            "GE / EG": `"Encouragement transforms potential into action."`,
            "DE / ED": `"Insight is the bridge between vision and action."`,
            "WE / EW": `"Seeing the bigger picture inspires us to make a real difference."`,
            "DT / TD": `"A focused mind turns vision into achievement."`,
            "GT / TG": `"Bold actions inspire progress, even in the face of adversity."`,
            "IE / EI": `"Creativity flourishes when feedback meets responsive design."`,
            "DG / GD": `"Action guided by intuition sparks great change."`,
            "IT / TI": `"A well-planned strategy turns ideas into reality."`,
            "ID / DI": `"Innovation is nurtured by thoughtful experimentation."`,
            "WT / TW": `"Thoughtful action is the cornerstone of progress."`,
            "IG / GI": `"Innovation thrives on passion—and a shared vision."`,
            "WI / IW": `"Imagination is the seed; action is the fruit."`,
            "WD / DW": `"Wisdom is understanding the power of perspective."`,
            "WG / GW": `"Inspiration is the first step toward transformation."`
         };

        // --- Helper Functions ---
        function getTypeClass(type) { if (type === 'Responsive') return 'type-resp'; if (type === 'Disruptive') return 'type-disrupt'; if (type === 'Mixed') return 'type-mixed'; return ''; }
        function getTypeText(type) { if (type === 'Responsive') return "Double Responsive"; if (type === 'Disruptive') return "Double Disruptive"; if (type === 'Mixed') return "Mixed Pairing"; return type; }
        function getTypeTooltip(type) { if (type === 'Responsive') return "Combines two Responsive Geniuses (W, D, E)."; if (type === 'Disruptive') return "Combines two Disruptive Geniuses (I, G, T)."; if (type === 'Mixed') return "Combines one Responsive (W, D, E) and one Disruptive (I, G, T) Genius."; return ''; }
        function getValueIcon(value) {
             const icons = {
                courageous: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>`,
                humble: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="8 12 12 16 16 12"/><line x1="12" y1="8" x2="12" y2="16"/></svg>`,
                empowering: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`, // Lightning Bolt
                connected: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>`,
                kind: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>`
             };
             return icons[value.toLowerCase()] || '';
        }

        // --- Grid Item Creation ---
        function createGridItem(data, index) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'pairing-card bg-gradient-to-br from-white to-slate-50 dark:from-slate-800 dark:to-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg shadow-md p-4 cursor-pointer flex flex-col transition-colors duration-300';
            itemDiv.setAttribute('data-index', index);

            const nameParts = data.name.match(/^(\W+)\s*(.*)$/) || [null, '', data.name];
            const icon = nameParts[1].trim();
            const nameText = nameParts[2].trim();

            // *** MODIFICATION: Removed whitespace-nowrap from h3 ***
            itemDiv.innerHTML = `
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-1">Rank ${data.rank}/15 (${data.frequency.toFixed(1)}%)</p>
                <h3 class="text-lg font-semibold text-slate-800 dark:text-white mb-1 flex items-center gap-2">
                    <span class="pairing-icon">${icon}</span>
                    <span class="pairing-name-text">${nameText}</span>
                </h3>
                <p class="text-sm text-slate-500 dark:text-slate-400">${data.letters}</p>
            `;

            itemDiv.addEventListener('click', () => openModal(index));
            itemDiv.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    openModal(index);
                }
            });
            itemDiv.setAttribute('tabindex', '0');
            itemDiv.setAttribute('role', 'button');
            itemDiv.setAttribute('aria-haspopup', 'dialog');
            itemDiv.setAttribute('aria-label', `View details for ${nameText}`);
            return itemDiv;
        }

        // --- Modal Functions ---
        const modal = document.getElementById('pairing-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalSubtitle = document.getElementById('modal-subtitle');
        const modalCloseButton = document.getElementById('modal-close-button');
        const modalBackdrop = modal.querySelector('.modal-backdrop');
        const modalCoreStrength = document.getElementById('modal-core-strength');
        const modalPairingTypeBadge = document.getElementById('modal-pairing-type-badge');
        const modalPairingTypeTooltip = document.getElementById('modal-pairing-type-tooltip');
        const modalValueBadges = document.getElementById('modal-value-badges');
        const modalValueRationale = document.getElementById('modal-value-rationale');
        const modalQuote = document.getElementById('modal-quote');
        const modalInteraction = document.getElementById('modal-interaction');
        const modalChallenges = document.getElementById('modal-challenges');
        const modalTendencies = document.getElementById('modal-tendencies');
        const modalDialogueProductive = document.getElementById('modal-dialogue-productive');
        const modalDialogueChallenged = document.getElementById('modal-dialogue-challenged');
        const modalDialogueGrowth = document.getElementById('modal-dialogue-growth');
        const modalContent = modal.querySelector('.modal-content');
        let previouslyFocusedElement = null;

        const ALL_VALUES_ORDERED = ['Courageous', 'Humble', 'Empowering', 'Connected', 'Kind'];

        function openModal(index) {
            const data = pairingsData[index];
            if (!data) return;
            previouslyFocusedElement = document.activeElement;
            modalTitle.textContent = data.name;
            modalSubtitle.textContent = `Rank ${data.rank}/15 (${data.frequency.toFixed(1)}%) - ${data.letters}`;
            modalCoreStrength.textContent = data.coreStrength;
            modalPairingTypeBadge.textContent = getTypeText(data.type);
            modalPairingTypeBadge.className = `type-badge ${getTypeClass(data.type)}`;
            modalPairingTypeTooltip.textContent = getTypeTooltip(data.type);

            const currentValues = data.valueAlignments || [];
            modalValueBadges.innerHTML = ALL_VALUES_ORDERED.map(value => {
                const isPresent = currentValues.includes(value);
                const dimClass = isPresent ? '' : 'value-badge-dimmed'; // Apply dimming class if not present
                const valueLower = value.toLowerCase();
                return `<span class="value-badge ${valueLower} ${dimClass}">
                           ${getValueIcon(value)}
                           ${value}
                        </span>`;
            }).join('');

            modalValueRationale.innerHTML = data.valueRationale
                ? data.valueRationale
                : `<span class="italic">No strong primary value alignment identified based on Genius alone.</span>`;
            modalQuote.textContent = inspirationQuotes[data.letters] || 'No quote available.';
            modalInteraction.innerHTML = data.interaction.map(point => `<p>${point}</p>`).join('');
            modalChallenges.textContent = data.challenges;
            modalTendencies.textContent = data.tendencies;
            modalDialogueProductive.textContent = data.dialogue.productive;
            modalDialogueChallenged.textContent = data.dialogue.challenged;
            modalDialogueGrowth.textContent = data.dialogue.growth;
            modal.classList.remove('modal-hidden');
            modal.classList.add('modal-visible');
            document.body.style.overflow = 'hidden';
            modalContent.scrollTop = 0;
            modalCloseButton.focus();
        }

        function closeModal() {
            modal.classList.add('modal-hidden');
            modal.classList.remove('modal-visible');
            document.body.style.overflow = '';
             if (previouslyFocusedElement) {
                previouslyFocusedElement.focus();
                previouslyFocusedElement = null;
            }
        }

        // Event Listeners for Modal
        modalCloseButton.addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', closeModal);
        modal.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                closeModal();
            }
            if (event.key === 'Tab') {
                 const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                 const firstElement = focusableElements[0];
                 const lastElement = focusableElements[focusableElements.length - 1];
                 if (!focusableElements.length) return;
                 if (event.shiftKey) {
                     if (document.activeElement === firstElement) {
                         lastElement.focus();
                         event.preventDefault();
                     }
                 } else {
                     if (document.activeElement === lastElement) {
                         firstElement.focus();
                         event.preventDefault();
                     }
                 }
            }
        });

        // --- Initialization ---
        window.addEventListener('load', () => {
            const gridContainer = document.getElementById('pairings-grid');
            gridContainer.innerHTML = ''; // Clear loading message
            const sortedData = [...pairingsData].sort((a, b) => a.rank - b.rank);
            sortedData.forEach((pairing, index) => {
                const item = createGridItem(pairing, index);
                gridContainer.appendChild(item);
            });

            // Theme Toggle Logic
            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.addEventListener('change', function(e) {
                const isDark = e.target.checked;
                document.documentElement.className = isDark ? 'dark' : 'light';
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            });
             const currentTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
             document.documentElement.className = currentTheme;
             themeToggle.checked = currentTheme === 'dark';
        });
    </script>

</body>
</html>
